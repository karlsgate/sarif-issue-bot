# SARIF Issue Bot

A GitHub Action to create and manage issues based on SARIF output using GitHub CLI.

## Description

This action processes SARIF (Static Analysis Results Interchange Format) files and creates or updates GitHub issues based on the vulnerabilities found. It's designed to work with security scanning tools that produce SARIF output, such as Docker Scout.

**Note:** This action has currently only been tested with CVE (Common Vulnerabilities and Exposures) data. Its behavior with other types of SARIF data may vary.

## Features

- Creates issues for new vulnerabilities
- Updates existing issues with new information
- Closes resolved issues (optional)
- Reopens previously closed issues if vulnerabilities reappear (optional)
- Adds severity labels to issues
- Supports custom labels

## Inputs

| Input | Description | Required | Default |
|-------|-------------|----------|---------|
| `github-token` | GitHub token for authentication | Yes | N/A |
| `sarif-file` | Path to the SARIF file | Yes | N/A |
| `image-name` | Docker image name | Yes | N/A |
| `label` | Additional label added to issue | No | '' |
| `allow-reopening` | Allow reopening of previously closed issues | No | true |
| `allow-closing` | Allow closing of resolved issues | No | true |

## Usage

To use this action in your workflow, add the following step:

```yaml
- name: Run SARIF Issue Bot
  uses: your-username/sarif-issue-bot@v1
  with:
    github-token: ${{ secrets.GITHUB_TOKEN }}
    sarif-file: path/to/sarif-output.json
    image-name: your-docker-image
    label: custom-label
```

## Workflow Permissions

This action requires specific permissions to function correctly. Make sure to include the following permissions in your workflow:

```yaml
permissions:
  contents: read
  issues: write
```

These permissions allow the action to read repository contents and manage issues.

## Example Workflow

Here's an example of how to integrate this action into a workflow that runs Docker Scout and then processes the SARIF output:

```yaml
name: Security Scan and Issue Management

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

permissions:
  contents: read
  issues: write
  
jobs:
  scan-and-manage-issues:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3

    - name: Run Docker Scout
      uses: docker/scout-action@v1
      with:
        command: cves
        image: your-image:tag
        output-format: sarif
        output-file: scout-results.sarif

    - name: Run SARIF Issue Bot
      uses: your-username/sarif-issue-bot@v1
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        sarif-file: scout-results.sarif
        image-name: your-image # No tag needed, unless you want it in the title of the issue
        label: docker-security
```

## Limitations

- This action has only been tested with CVE data generated by Docker Scout. Its effectiveness with other types of SARIF data or from other tools has not been verified.
- The action assumes a specific structure in the SARIF file. If you're using a tool other than Docker Scout, you may need to adjust the SARIF parsing logic in the action's script.

## License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Support

If you encounter any problems or have any questions, please open an issue in this repository.